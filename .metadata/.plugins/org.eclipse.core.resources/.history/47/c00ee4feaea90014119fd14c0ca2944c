# Train a linear SVM using raw pixels as features. Plot the error rate on a validation
# set versus the number of training examples that you used to train your classier. The
# choices of the number of training examples should be 100, 200, 500, 1,000, 2,000, 5,000
# and 10,000. Make sure you set aside 10,000 other training points as a validation set.
# You should expect accuracies between 70% and 90% at this stage

############# IMPORTS ############# 

import scipy as sp
import numpy as np
from sklearn import svm
from scipy import io
import random
from skimage.io._plugins.qt_plugin import ImageLabel

DEBUG = True
############# FILE STUFF ############# 

testFileMNIST = "./digit-dataset/test.mat"
trainFileMNIST = "./digit-dataset/train.mat"

trainMat = sp.io.loadmat(trainFileMNIST)
testMat = sp.io.loadmat(testFileMNIST)

if DEBUG:
    print 50*'-'
    print trainMat, testMat

############# GET DATA ############# 

imageData = np.array(trainMat['train_images'])
imageData = np.rollaxis(imageData, 2, 0)                # move the index axis to be the first 
imageLabels = np.array(trainMat['train_labels'])

imageComplete = zip(imageData, imageLabels)

if DEBUG:
    print 50*'-'
    print ("Shapes of image data and labels: ", imageData.shape, 
                                    imageLabels.shape, len(imageComplete))
    
    print "Image/Digit 10000:\n", imageComplete[20000]
    
############# SET ASIDE VALIDATION DATA (10,000) ############# 
# VERIFY ORDER
if DEBUG == False:    
    i = 0
    print 50*'-'
    for elem in imageComplete:
        print elem[1]
        i+=1
        if i > 5000:
            break
        
# SHUFFLE THE IMAGES
random.shuffle(imageComplete)

# VERIFY SHUFFLE
if DEBUG == False:
    i = 0    
    print 50*'-'
    for elem in imageComplete:
        print elem[1]
        i+=1
        if i > 5000:
            break

# Set aside 50,000-60,000 to validate
    
############# TRAIN SVM ############# 
clf = svm.SVC()

if DEBUG:
    print 50*'-'
    print "Length of unzipped data: ", len((imageComplete[0][0]))

i =0


shuffledData = np.empty((60000, 28, 28))
shuffledLabels = np.empty(60000)

for elem in imageComplete:
    shuffledData[i] = (elem[0][0])
    shuffledLabels[i] = (elem[0][1])
    i+=1

if DEBUG:
    print 50*'-'
    print "Shuffled Data and Label shape: ", shuffledData.shape, shuffledLabels.shape


clf.fit(shuffledData[:50000], shuffledLabels[:50000])
print clf.predict(shuffledData[50000:])

############# PLOT RESULTS ############# 

    
print 50*'-'
print "End of File"