# Train a linear SVM using raw pixels as features. Plot the error rate on a validation
# set versus the number of training examples that you used to train your classier. The
# choices of the number of training examples should be 100, 200, 500, 1,000, 2,000, 5,000
# and 10,000. Make sure you set aside 10,000 other training points as a validation set.
# You should expect accuracies between 70% and 90% at this stage

############# IMPORTS ############# 

import scipy as sp
import numpy as np
from sklearn import svm
from scipy import io
import random
from skimage.io._plugins.qt_plugin import ImageLabel

DEBUG = True
############# FILE STUFF ############# 

testFileMNIST = "./digit-dataset/test.mat"
trainFileMNIST = "./digit-dataset/train.mat"

trainMat = sp.io.loadmat(trainFileMNIST)
testMat = sp.io.loadmat(testFileMNIST)

if DEBUG:
    print 50*'-'
    print trainMat, testMat

############# GET DATA ############# 

imageData = np.array(trainMat['train_images'])
imageData = np.rollaxis(imageData, 2, 0)                # move the index axis to be the first 
imageLabels = np.array(trainMat['train_labels'])

imageComplete = zip(imageData, imageLabels)

if DEBUG:
    print 50*'-'
    print ("Shapes of image data and labels: ", imageData.shape, 
                                    imageLabels.shape, len(imageComplete))
    
    print "Image/Digit 10000:\n", imageComplete[20000]
    
############# SET ASIDE VALIDATION DATA (10,000) ############# 
# VERIFY ORDER
if DEBUG == False:    
    i = 0
    print 50*'-'
    for elem in imageComplete:
        print elem[1]
        i+=1
        if i > 5000:
            break
        
# SHUFFLE THE IMAGES
random.shuffle(imageComplete)

# VERIFY SHUFFLE
if DEBUG == False:
    i = 0    
    print 50*'-'
    for elem in imageComplete:
        print elem[1]
        i+=1
        if i > 5000:
            break

# Set aside 50,000-60,000 to validate
    
############# TRAIN SVM ############# 
C = 1.0
clf = svm.SVC(kernel='linear', C=C)

if DEBUG:
    print 50*'-'
    print "Length of unzipped data: ", ((imageComplete[0][0].shape))

i =0


shuffledData = []
shuffledLabels = []

for elem in imageComplete:
    shuffledData.append((elem[0]).flatten())
    shuffledLabels.append((elem[1][0]))
    i+=1

if DEBUG:
    print 50*'-'
    print "Shuffled Data and Label shape: ", len(shuffledData[0]), len(shuffledLabels)


clf.fit(shuffledData[:100], np.array(shuffledLabels[:100]))
print shuffledLabels[:100]
predicted clf.predict(shuffledData[55000:])
print shuffledLabels[55000:]

############# PLOT RESULTS ############# 

    
print 50*'-'
print "End of File"